@page "/JobCreation"
@rendermode InteractiveServer

@using ESOF.WebApp.DBLayer.Entities
@using Blazored.Typeahead

<PageTitle>Job Creation</PageTitle>

<h3>Job Creation</h3>

<style>
    form {
        display: grid;
        grid-template-columns: max-content 1fr;
        gap: 20px;
        max-width: 600px;
        margin-left: 300px;
        margin-right: auto;
    }
    label {
        text-align: right;
        padding-right: 20px;
        height: 40px;
        line-height: 40px;
    }
    input, textarea, select {
        width: 100%;
        padding: 5px;
        box-sizing: border-box;
    }
    .description-label, .skills-label, .nice-to-have-skills-label {
        grid-column: 1 / span 2;
        text-align: left;
        height: 20px;
    }
    .description-input, .skills-input, .nice-to-have-skills-input {
        grid-column: 1 / span 2;
        height: auto;
    }
    .checkbox-container {
        display: flex;
        flex-wrap: wrap;
    }
    .checkbox-container label {
        display: flex;
        align-items: center;
        margin-right: 20px;
    }
    .checkbox-container input {
        margin-right: 10px;
    }
    button {
        grid-column: span 2;
        justify-self: center;
        padding: 10px 30px;
        cursor: pointer;
    }
</style>

<form @onsubmit="HandleSubmit">

    <div>
        <label for="salary">Position:</label>
        <InputText id="salary" @bind-Value="job.Position" />    
    </div>

    <div>
        <label for="date">End Date:</label>
        <InputDate id="date" @bind-Value="job.EndDate" />
    </div>

    <div>
        <label for="experience">Experience:</label>
        <InputText id="experience" @bind-Value="job.Experience" />
    </div>
    
    <div>
        <label for="commitment">Commitment:</label>
        <InputSelect id="commitment" @bind-Value="job.Commitment">
            <option value="">--- Select Commitment Type ---</option>
            <option value="@CommitmentType.Hourly">Hourly</option>
            <option value="@CommitmentType.PartTime">Part Time</option>
            <option value="@CommitmentType.FullTime">Full Time</option>
        </InputSelect>
    </div>

    <div>
        <label for="localization">Localization:</label>
        <InputText id="localization" @bind-Value="job.Localization" />
    </div>
    
    <div>
        <label for="remote">Remote:</label>
        <InputSelect id="remote" @bind-Value="job.Remote">
            <option value="">--- Select Remote Type ---</option>
            <option value="@RemoteType.Hybrid">Hybrid</option>
            <option value="@RemoteType.Home">Home</option>
            <option value="@RemoteType.Office">Office</option>
        </InputSelect>
    </div>

    <div>
        <label for="language">Language:</label>
        <InputText id="language" @bind-Value="job.Language" />
    </div>
    
    <div>
        <label for="education">Education:</label>
        <InputSelect id="education" @bind-Value="job.Education">
            <option value="">--- Select Education Level ---</option>
            <option value="@EducationLevel.PrimaryEducation">Primary Education</option>
            <option value="@EducationLevel.SecondaryEducation">Secondary Education</option>
            <option value="@EducationLevel.Bachelors">Bachelors</option>
            <option value="@EducationLevel.Masters">Masters</option>
            <option value="@EducationLevel.Doctoral">Doctoral</option>
        </InputSelect>
    </div>

    <!-- Required Skills -->
    <div class="skills-label">
        <label for="skills">Required Skills:</label>
    </div>
    <div class="skills-input">
        <div class="checkbox-container">
            @foreach (var skill in availableSkills)
            {
            <label>
                <input type="checkbox" value="@skill.SkillId" @onchange="e => UpdateSkills(e, skill, true)" />
                @skill.Name
            </label>
            }
        </div>
    </div>

    <!-- Nice to Have Skills -->
    <div class="nice-to-have-skills-label">
        <label for="niceToHaveSkills">Nice to Have Skills:</label>
    </div>
    <div class="nice-to-have-skills-input">
        <div class="checkbox-container">
            @foreach (var skill in availableSkills)
            {
            <label>
                <input type="checkbox" value="@skill.SkillId" @onchange="e => UpdateSkills(e, skill, false)" />
                @skill.Name
            </label>
            }
        </div>
    </div>

    <div class="description-label">
        <label for="description">Description:</label>
    </div>
    <div class="description-input">
        <InputTextArea id="description" @bind-Value="job.Description"></InputTextArea>
    </div>

    <button type="submit">Submit</button>
</form>

@code {
    
    private Job job = new Job
    {
        EndDate = DateTime.Now,
        RequiredSkills = new List<JobSkill>(),
        NiceToHaveSkills = new List<JobSkill>()
    };

    private List<Skill> availableSkills = new List<Skill>
    {
        new Skill { SkillId = Guid.NewGuid(), Name = "C#" },
        new Skill { SkillId = Guid.NewGuid(), Name = "JavaScript" },
        new Skill { SkillId = Guid.NewGuid(), Name = "SQL" },
        new Skill { SkillId = Guid.NewGuid(), Name = "Python" },
        new Skill { SkillId = Guid.NewGuid(), Name = "Java" },
        new Skill { SkillId = Guid.NewGuid(), Name = "Python" },
        new Skill { SkillId = Guid.NewGuid(), Name = "Java" },
        
        // Add more skills as needed
    };

    private void UpdateSkills(ChangeEventArgs e, Skill skill, bool isRequired)
    {
        if ((bool)e.Value)
        {
            if (isRequired)
            {
                job.RequiredSkills.Add(new JobSkill { JobId = job.JobId, SkillId = skill.SkillId });
            }
            else
            {
                job.NiceToHaveSkills.Add(new JobSkill { JobId = job.JobId, SkillId = skill.SkillId });
            }
        }
        else
        {
            if (isRequired)
            {
                var skillToRemove = job.RequiredSkills.FirstOrDefault(s => s.SkillId == skill.SkillId);
                if (skillToRemove != null)
                {
                    job.RequiredSkills.Remove(skillToRemove);
                }
            }
            else
            {
                var skillToRemove = job.NiceToHaveSkills.FirstOrDefault(s => s.SkillId == skill.SkillId);
                if (skillToRemove != null)
                {
                    job.NiceToHaveSkills.Remove(skillToRemove);
                }
            }
        }
    }
    
    private void HandleSubmit()
    {
        Console.WriteLine($"Position: {job.Position}");
        Console.WriteLine($"Date: {job.EndDate:dd/MM/yyyy}");
        Console.WriteLine($"Commitment: {job.Commitment}");
        Console.WriteLine($"Remote: {job.Remote}");
        Console.WriteLine($"Localization: {job.Localization}");
        Console.WriteLine($"Education: {job.Education}");
        Console.WriteLine($"Experience: {job.Experience}");
        Console.WriteLine($"Required Skills: {string.Join(", ", job.RequiredSkills.Select(js => availableSkills.FirstOrDefault(s => s.SkillId == js.SkillId)?.Name))}");
        Console.WriteLine($"Nice to Have Skills: {string.Join(", ", job.NiceToHaveSkills.Select(js => availableSkills.FirstOrDefault(s => s.SkillId == js.SkillId)?.Name))}");
        Console.WriteLine($"Language: {job.Language}");
        Console.WriteLine($"Description: {job.Description}");
    }
    
}